# מדריך ניתוח הקלטות ארוכות 🎯

## סקירה כללית

מערכת ניתוח הקלטות ארוכות נועדה לטפל בהקלטות של 1-2 שניות בקצב דגימה של 56 MSps. המערכת מזהה באופן אוטומטי פקטות שונות בהקלטה, מקבצת אותן לפי מאפיינים דומים (תדר ורוחב פס), ובוחרת את הפקטה האיכותית ביותר מכל קבוצה.

## תכונות עיקריות

- ✅ **זיהוי אוטומטי של פקטות** - ללא צורך בספקטרוגרמות או גרפים
- ✅ **חיתוך עם מרווח בטיחות** - מבטיח שלא חסרים נתונים חשובים
- ✅ **קיבוץ פקטות דומות** - מזהה פקטות מאותו סוג
- ✅ **בחירת איכות מיטבית** - בוחר את הפקטה הטובה ביותר מכל קבוצה
- ✅ **פורמט תואם** - שומר בפורמט MAT תואם לאפליקציה הקיימת

## שימוש דרך הממשק הגרפי

### 1. פתיחת הטאב החדש
בממשק הגרפי הראשי, עבור לטאב **"Long Recording Analysis"**

### 2. בחירת קובץ הקלטה
- לחץ על **"🔍 בחר קובץ הקלטה (.mat)"**
- בחר קובץ MAT עם ההקלטה הארוכה

### 3. הגדרת פרמטרים
- **קצב דגימה**: 56 MHz (ברירת מחדל)
- **מרווח בטיחות**: 0.1 ms (ברירת מחדל)
- **תיקיית פלט**: אופציונלי - אם לא מוגדר, נוצרת תיקייה אוטומטית

### 4. הפעלת הניתוח
לחץ על **"🚀 התחל ניתוח"** וצפה בתוצאות בזמן אמת

## שימוש דרך קובץ פייתון

```python
from long_recording_analyzer import LongRecordingAnalyzer

# יצירת מנתח
analyzer = LongRecordingAnalyzer(
    sample_rate=56e6,        # 56 MHz
    safety_margin_ms=0.1     # 0.1 ms margin
)

# ניתוח הקלטה
result = analyzer.analyze_recording(
    input_file="my_recording.mat",
    output_dir="extracted_packets"  # אופציונלי
)

if result:
    print(f"נשמרו {result['packet_count']} פקטות")
    print(f"בתיקייה: {result['output_dir']}")
```

## שימוש מהמסוף

```bash
# ניתוח הקלטה בודדת
python long_recording_analyzer.py my_recording.mat

# הדגמה עם נתונים מלאכותיים
python demo_long_recording.py
```

## פרמטרים מתקדמים

ניתן לכוונן את הפרמטרים הבאים במחלקה `LongRecordingAnalyzer`:

### פרמטרי זיהוי פקטות
- **power_threshold_db**: סף כוח יחסי לזיהוי פקטות (-40 dB ברירת מחדל)
- **min_packet_samples**: מינימום אורך פקטה (10ms ברירת מחדל)
- **max_packet_samples**: מקסימום אורך פקטה (500ms ברירת מחדל)

### פרמטרי קיבוץ פקטות
- **frequency_tolerance_hz**: סובלנות תדר לקיבוץ (50 kHz ברירת מחדל)
- **bandwidth_tolerance**: סובלנות רוחב פס (20% ברירת מחדל)

## אלגוריתם בחירת איכות

המערכת מעניקה ניקוד לכל פקטה על בסיס:

- **50% SNR** - יחס האות לרעש
- **30% עוצמה** - רמת האות בdB
- **20% משך** - פקטות ארוכות יותר מועדפות

## פורמט קבצי הפלט

הפקטות נשמרות כקבצי MAT עם המבנה הבא:

```matlab
% קובץ: packet_01_freq_5.0MHz_bw_2.3MHz.mat
Y          % הנתונים של הפקטה (complex64)
metadata   % מטא-נתונים:
  - center_freq     % תדר מרכזי בHertz
  - bandwidth      % רוחב פס בHertz
  - power_db       % עוצמה ממוצעת בdB
  - snr_db         % יחס אות לרעש בdB
  - duration_ms    % משך הפקטה במילישניות
  - sample_rate    % קצב דגימה
  - extraction_time % זמן החילוץ
```

## דוגמת פלט

```
🚀 מתחיל ניתוח הקלטה ארוכה...
📁 טוען הקלטה: my_recording.mat
🗂️ גודל קובץ: 1234.5MB
⏱️ משך הקלטה: 1.50 שניות
📊 מספר דגימות: 84,000,000

🔍 מזהה פקטות בהקלטה...
📡 נמצאו 12 אזורי אות פוטנציאליים
✅ זוהו 8 פקטות תקינות

🔗 מקבץ פקטות דומות...
📋 נוצרו 3 קבוצות פקטות

📊 קבוצה תדר 5.0MHz: נבחרה פקטה עם SNR 23.4dB מתוך 3 פקטות
📊 קבוצה תדר 10.2MHz: נבחרה פקטה עם SNR 19.7dB מתוך 2 פקטות
📊 קבוצה תדר 15.5MHz: נבחרה פקטה עם SNR 25.1dB מתוך 3 פקטות

💾 נשמר: packet_01_freq_5.0MHz_bw_2.1MHz.mat (תדר: 5.0MHz, עוצמה: -12.3dB)
💾 נשמר: packet_02_freq_10.2MHz_bw_1.8MHz.mat (תדר: 10.2MHz, עוצמה: -15.7dB)
💾 נשמר: packet_03_freq_15.5MHz_bw_3.2MHz.mat (תדר: 15.5MHz, עוצמה: -9.8dB)

✅ ניתוח הושלם בהצלחה!
📁 תיקיית פלט: extracted_packets_my_recording_20241215_143022
📦 נשמרו 3 פקטות איכותיות
💽 גודל ממוצע לפקטה: 11,200 דגימות
```

## טיפים לשימוש מיטבי

### 1. הכנת קבצי הקלטה
- ודא שההקלטה בפורמט MAT עם משתנה 'Y'
- קצב דגימה מומלץ: 56 MHz
- אורך מומלץ: 1-2 שניות

### 2. כוונון פרמטרים
- **הקלטות עם הרבה רעש**: הגדל את power_threshold_db
- **פקטות קצרות מאוד**: הקטן את min_packet_samples
- **פקטות דומות לא מתקבצות**: הגדל את frequency_tolerance_hz

### 3. אופטימיזציית ביצועים
- הקלטות גדולות (>100MB) יימשכו זמן רב יותר
- סגור יישומים אחרים כדי לפנות זיכרון
- השתמש ב-SSD לביצועים טובים יותר

## פתרון בעיות נפוצות

### "לא נמצאו פקטות בהקלטה"
- בדוק שההקלטה מכילה אותות חזקים מספיק
- נסה להקטין את power_threshold_db
- ודא שהקצב דגימה נכון

### "שגיאה בטעינת הקלטה"
- ודא שהקובץ הוא MAT תקין
- בדוק שיש מספיק מקום בדיסק
- ודא שהקובץ לא פגום

### "פקטות לא מתקבצות כראוי"
- כוונן את frequency_tolerance_hz
- בדוק את bandwidth_tolerance
- ייתכן שהפקטות באמת שונות

---

**הערה חשובה**: מערכת זו מותאמת לעבודה עם קבצי MAT גדולים. ודא שיש מספיק זיכרון פנוי במערכת לפני הפעלת הניתוח.